<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<meta name="theme-color" content="#0b0f14" />
<title>RO→RU Тренажёр (PWA, офлайн)</title>
<link rel="manifest" id="pwa-manifest" />
<link rel="apple-touch-icon" id="apple-touch" />
<style>
  :root{--bg:#0b0f14;--fg:#e6e9ef;--muted:#9aa4b2;--card:#121720;--acc:#4ea4ff;--ok:#35c26b;--warn:#ffd166;--bad:#ff6b6b}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:var(--bg); color:var(--fg)}
  header{position:sticky;top:0;z-index:3; backdrop-filter:blur(8px); background:rgba(11,15,20,.8); border-bottom:1px solid #1c2533}
  .bar{display:flex;align-items:center;gap:.6rem; padding:.7rem .9rem}
  h1{font-size:1.05rem;margin:0;font-weight:700}
  .grow{flex:1}
  button, select, input, textarea{background:#0f1520;color:var(--fg); border:1px solid #202a3a; border-radius:14px; padding:.7rem .9rem; font-size:1rem}
  button{cursor:pointer}
  button.primary{background:var(--acc); color:#04111f; border:none; font-weight:700}
  button.ghost{background:transparent;border:1px solid #243044}
  button.sm{padding:.45rem .7rem; font-size:.9rem; border-radius:12px}
  .wrap{max-width:860px;margin:0 auto;padding:1rem}
  .grid{display:grid; gap:.9rem}
  .cards{display:grid; gap:.9rem}
  .card{background:var(--card); border:1px solid #1b2330; border-radius:18px; padding:1rem}
  .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
  .row.right{justify-content:flex-end}
  .muted{color:var(--muted)}
  .pill{padding:.25rem .6rem;border:1px solid #253347;border-radius:999px;font-size:.75rem}
  .tabs{display:flex; gap:.5rem; flex-wrap:wrap}
  .tab{padding:.55rem .8rem; border-radius:12px; border:1px solid #243044; background:#0d1420; cursor:pointer; font-weight:600}
  .tab.active{background:var(--acc); color:#04111f; border-color:transparent}
  .center{display:flex;flex-direction:column; align-items:center; justify-content:center; text-align:center}
  .big{font-size:1.5rem; font-weight:700}
  .xxl{font-size:2rem; font-weight:800}
  .hr{height:1px;background:#1b2330;margin:.8rem 0}
  .hidden{display:none}
  textarea{width:100%;min-height:100px}
  .flex{display:flex; gap:.6rem}
  .col{display:flex; flex-direction:column; gap:.5rem}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0a101a; border:1px solid #1c2635; border-radius:8px; padding:.1rem .35rem}
  .stat{display:grid; grid-template-columns:1fr 1fr; gap:.6rem}
  .stat .box{background:#0f1521;border:1px solid #1b2432;border-radius:14px;padding:.75rem}
  .right .kbd{margin-left:auto}
  input[type="file"]{padding:.45rem}
  .mc-grid{display:grid; gap:.6rem; grid-template-columns:1fr 1fr}
  .mc-grid button{min-height:56px}
  .toast{position:fixed; bottom:12px; left:0; right:0; margin:auto; width:max(280px, 50%); background:#101724; border:1px solid #1f2938; color:var(--fg); padding:.8rem 1rem; border-radius:12px; text-align:center; display:none}
  @media (max-width:640px){ .mc-grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="bar">
    <h1>RO→RU Тренажёр</h1>
    <span class="pill muted" id="duePill">Готово к повторению: 0</span>
    <div class="grow"></div>
    <button class="sm ghost" id="btnExport">Экспорт</button>
    <label class="sm ghost" for="fileImport" style="cursor:pointer">Импорт</label>
    <input id="fileImport" type="file" accept=".csv,.json" class="hidden">
    <button class="sm" id="btnSettings">Настройки</button>
  </div>
</header>

<div class="wrap">
  <div class="tabs" id="modeTabs">
    <div class="tab active" data-mode="review">Флеш-карты (SRS)</div>
    <div class="tab" data-mode="choice">Вибір перекладу</div>
    <div class="tab" data-mode="dictate">Диктант</div>
    <div class="tab" data-mode="repeat">Слухай і повторюй</div>
    <div class="tab" data-mode="manage">База і прогресс</div>
  </div>

  <div id="screen-review" class="cards">
    <div class="card center" id="reviewCard">
      <div class="muted">Карточка</div>
      <div class="xxl" id="qText">—</div>
      <div class="hr"></div>
      <button id="btnShow" class="primary">Показать ответ</button>
      <div id="aBlock" class="hidden">
        <div id="aText" class="big" style="margin:.4rem 0 .7rem"></div>
        <div class="row center">
          <button data-grade="0" class="ghost">Забыл</button>
          <button data-grade="3" class="ghost">Трудно</button>
          <button data-grade="4" class="ghost">Хорошо</button>
          <button data-grade="5" class="primary">Легко</button>
        </div>
      </div>
      <div class="row" style="margin-top:.6rem">
        <button id="btnTTS" class="ghost">Озвучить</button>
        <span class="muted">RO→RU, інтервальні повторения SM‑2 lite</span>
      </div>
    </div>
  </div>

  <div id="screen-choice" class="cards hidden">
    <div class="card">
      <div class="row"><div class="muted">Вибери переклад</div><div class="grow"></div><button id="choiceSpeak" class="ghost sm">▶︎</button></div>
      <div class="xxl" id="choiceQ">—</div>
      <div class="mc-grid" id="choiceOptions"></div>
      <div id="choiceFeedback" class="row muted" style="margin-top:.6rem"></div>
    </div>
  </div>

  <div id="screen-dictate" class="cards hidden">
    <div class="card">
      <div class="row"><div class="muted">Диктант: введи переклад</div><div class="grow"></div><button id="dictSpeak" class="ghost sm">▶︎</button></div>
      <div id="dictQ" class="big" style="margin:.2rem 0 .6rem">—</div>
      <input id="dictInput" placeholder="Введи перевод на русский" />
      <div class="row right" style="margin-top:.6rem">
        <button id="dictCheck" class="primary">Проверить</button>
      </div>
      <div id="dictFeedback" class="muted" style="margin-top:.6rem"></div>
    </div>
  </div>

  <div id="screen-repeat" class="cards hidden">
    <div class="card center">
      <div class="muted">Прослухай і повтори</div>
      <div id="repPrompt" class="big">—</div>
      <div class="row" style="margin-top:.6rem">
        <button id="repPlay" class="primary">Произнести</button>
        <button id="repListen" class="ghost">Сравнить голосом</button>
      </div>
      <div id="repFeedback" class="muted" style="margin-top:.6rem"></div>
    </div>
  </div>

  <div id="screen-manage" class="cards hidden">
    <div class="card">
      <div class="row"><div class="big">База слов</div><div class="grow"></div><button id="btnAdd" class="sm">Добавить</button></div>
      <div class="hr"></div>
      <div class="muted" style="margin-bottom:.6rem">Формат CSV из Anki: колонки <span class="kbd">front(ro)</span>, <span class="kbd">back(ru)</span>. Разделитель любой: запятая, точка с запятой, таб.</div>
      <div id="list"></div>
    </div>

    <div class="card">
      <div class="big">Статистика</div>
      <div class="stat" style="margin-top:.6rem">
        <div class="box"><div class="muted">Всего карточек</div><div id="stTotal" class="big">0</div></div>
        <div class="box"><div class="muted">Сегодня к повтору</div><div id="stDue" class="big">0</div></div>
        <div class="box"><div class="muted">Выучено</div><div id="stMature" class="big">0</div></div>
        <div class="box"><div class="muted">Сессия: верно</div><div id="stCorrect" class="big">0</div></div>
      </div>
    </div>

    <div class="card">
      <div class="big">Настройки</div>
      <div class="col" style="margin-top:.6rem">
        <label>Голос TTS (рекомендуется ro-RO)
          <select id="voiceSel"></select>
        </label>
        <label>Громкость TTS <input id="vol" type="range" min="0" max="1" step="0.05" value="1"></label>
        <label>Скорость TTS <input id="rate" type="range" min="0.6" max="1.4" step="0.05" value="1"></label>
      </div>
      <div class="row right" style="margin-top:.6rem">
        <button id="btnWipe" class="ghost">Сбросить базу</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// === PWA: динамический manifest + Service Worker (через Blob) ===
(function(){
  // Иконка 192x192 (простая, как заглушка) как data:PNG
  const icon192 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAQAAAB3T2mVAAABxElEQVR4nO3ZwQ3CMBQF0T0o2Z3gKq2vJ2q3Rj1w8aARmVw4i7b0m6L2qgR0z0b9l1bS7v4h5g0vK9v5qg1EwAAAAAAAAAAAAAAAAAAAAAAAPh1b0K1w7c0f2y7m4bqLw7l8r5p7Xl0b6o0nI2M9C2lWnhq2yR8m3E4m3s5bG0x2r3s9eQ1m8mH0yX7s6dNwT4y3p5bOsvb2qfXr8cKq8sS5E0n6wC1m2O+g1i3l5g9Y6jv5v1y5QpP2cNqZk5r3aYvZr1b7mG0qzY6a3Y7mQ5i3Z3Y+eYj4v5cX0a6w9mH2s8bCq9o3mW3s8bqZ+g2rJd3e9b2r6l+2d9m3qz7JZr2b7b+9d9gAAAAAAAAAAAAAAAAAAAAAAAN4y2vN6FQ2qCqj3X1wS9Y6H9oV8w7vVw1b7Fv1f3Qm8mJ8kQ6o7YcVb+L3U2r6b7v0v7l0w5cWmP4KcU6o7YcVb+L3U2r6b7v0v7l0w5cWmP4KcV6mMfz1K2qgQ9UjXzC1h2gqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgqgAAAAAAB/By2BHCQX1pWAAAAAElFTkSuQmCC';
  const icon512 = icon192; // заглушка
  const startUrl = (location.pathname.split('/').slice(-1)[0]||'index.html');
  const MANIFEST = {
    name: 'RO→RU Тренажёр', short_name: 'RO-RU',
    display: 'standalone', start_url: './'+startUrl, scope: './',
    background_color: '#0b0f14', theme_color: '#0b0f14',
    icons: [
      {src: icon192, sizes: '192x192', type: 'image/png', purpose:'any maskable'},
      {src: icon512, sizes: '512x512', type: 'image/png', purpose:'any maskable'}
    ]
  };
  const blob = new Blob([JSON.stringify(MANIFEST)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  document.getElementById('pwa-manifest').setAttribute('href', url);
  document.getElementById('apple-touch').setAttribute('href', icon192);

  // Service Worker: только по HTTPS или http://localhost
  if(('serviceWorker' in navigator) && (location.protocol==='https:' || location.hostname==='localhost')){
    const swCode = `const CACHE='ro-ru-cache-v1';
self.addEventListener('install',e=>{self.skipWaiting();});
self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim());});
self.addEventListener('fetch',e=>{
  if(e.request.method!=='GET') return;
  e.respondWith(
    caches.match(e.request).then(r=> r || fetch(e.request).then(resp=>{
      const copy=resp.clone();
      caches.open(CACHE).then(c=>{ if(resp.ok) c.put(e.request, copy); });
      return resp;
    }).catch(()=>caches.match('./'+(self.registration.scope.split('/').filter(Boolean).slice(-1)[0]||'index.html'))))
  );
});`;
    const swUrl = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'}));
    navigator.serviceWorker.register(swUrl, {scope:'./'}).catch(()=>{});
  }
})();
</script>

<script>
// === ДАННЫЕ + ЛОГИКА ТРЕНАЖЁРА ===
const LS_KEY = 'ro_ru_trainer_cards_v1';
let cards = [];
let session = { correct:0 };
const seed = [ ['Bună dimineața','Доброе утро'], ['Mulțumesc','Спасибо'], ['Unde este stația de autobuz?','Где автобусная остановка?'], ['Cât costă?','Сколько стоит?'], ['Îmi pare rău','Извините'] ];
function isoToday(){ return new Date().toISOString().slice(0,10); }
function todayMidnight(){ const d=new Date(); d.setHours(0,0,0,0); return d; }
function load(){ try{ const raw=localStorage.getItem(LS_KEY); if(raw){ cards = JSON.parse(raw); } if(!cards.length){ initSeed(); } }catch(e){ initSeed(); } updateDuePill(); }
function save(){ localStorage.setItem(LS_KEY, JSON.stringify(cards)); updateDuePill(); updateStats(); }
function initSeed(){ cards = seed.map((x,i)=>({id:'seed'+i, ro:x[0], ru:x[1], ef:2.5, ivl:0, reps:0, lapses:0, dueISO:isoToday()})); save(); }
function updateDuePill(){ const due = dueCards().length; document.getElementById('duePill').textContent = `Готово к повторению: ${due}`; }
function dueCards(){ const t=todayMidnight().getTime(); return cards.filter(c=> new Date(c.dueISO).getTime() <= t); }
function sm2Schedule(card, grade){ if(grade < 3){ card.reps=0; card.ivl=1; card.ef=Math.max(1.3, card.ef-0.2); card.lapses+=1; } else { if(card.reps===0){ card.ivl=1; } else if(card.reps===1){ card.ivl=6; } else { card.ivl=Math.round(card.ivl*card.ef); } card.ef=Math.max(1.3, card.ef + (0.1 - (5 - grade)*(0.08 + (5 - grade)*0.02))); card.reps+=1; } const next=new Date(); next.setDate(next.getDate()+card.ivl); card.dueISO=next.toISOString().slice(0,10); }
const screens=['review','choice','dictate','repeat','manage'];
function showScreen(name){ screens.forEach(s=>{ document.getElementById('screen-'+s).classList.toggle('hidden', s!==name); document.querySelector(`.tab[data-mode="${s}"]`).classList.toggle('active', s===name); }); if(name==='manage'){ renderList(); updateStats(); } if(name==='review'){ setupReview(); } if(name==='choice'){ setupChoice(); } if(name==='dictate'){ setupDict(); } if(name==='repeat'){ setupRepeat(); } }
let current=null; function pickDueOrRandom(){ const d=dueCards(); if(d.length) return d[Math.floor(Math.random()*d.length)]; if(cards.length) return cards[Math.floor(Math.random()*cards.length)]; return null; }
function setupReview(){ current=pickDueOrRandom(); const q=document.getElementById('qText'); const a=document.getElementById('aText'); const aBlock=document.getElementById('aBlock'); aBlock.classList.add('hidden'); document.getElementById('btnShow').classList.remove('hidden'); if(!current){ q.textContent='Нет карточек'; a.textContent=''; return; } q.textContent=current.ro; a.textContent=current.ru; }
document.getElementById('btnShow').onclick=()=>{ document.getElementById('aBlock').classList.remove('hidden'); document.getElementById('btnShow').classList.add('hidden'); };
document.querySelectorAll('#reviewCard [data-grade]').forEach(b=>{ b.addEventListener('click',()=>{ if(!current) return; const g=parseInt(b.dataset.grade,10); const wasDue=new Date(current.dueISO).getTime()<=todayMidnight().getTime(); sm2Schedule(current,g); save(); if(wasDue && g>=3){ session.correct++; updateStats(); } setupReview(); }); });
let choiceAns=null; function setupChoice(){ const qEl=document.getElementById('choiceQ'); const box=document.getElementById('choiceOptions'); const fb=document.getElementById('choiceFeedback'); fb.textContent=''; box.innerHTML=''; if(cards.length<4){ qEl.textContent='Недостаточно карточек (нужно ≥ 4)'; return; } const idx=Math.floor(Math.random()*cards.length); const q=cards[idx]; qEl.textContent=q.ro; choiceAns=q.ru; const opts=new Set([q.ru]); while(opts.size<4){ opts.add(cards[Math.floor(Math.random()*cards.length)].ru); } [...opts].sort(()=>Math.random()-0.5).forEach(txt=>{ const b=document.createElement('button'); b.className='ghost'; b.textContent=txt; b.onclick=()=>{ if(txt===choiceAns){ fb.textContent='Верно'; fb.style.color='var(--ok)'; session.correct++; } else { fb.textContent=`Неверно. Правильно: ${choiceAns}`; fb.style.color='var(--bad)'; } setTimeout(setupChoice, 900); }; box.appendChild(b); }); }
let dictQ=null; function setupDict(){ const idx=Math.floor(Math.random()*cards.length); dictQ=cards[idx]||null; document.getElementById('dictQ').textContent = dictQ? dictQ.ro : 'Нет карточек'; document.getElementById('dictInput').value=''; document.getElementById('dictFeedback').textContent=''; }
document.getElementById('dictCheck').onclick=()=>{ const v=document.getElementById('dictInput').value.trim(); const fb=document.getElementById('dictFeedback'); if(!dictQ) return; const correct=normalize(dictQ.ru); const user=normalize(v); if(user===correct){ fb.textContent='Верно'; fb.style.color='var(--ok)'; session.correct++; } else { fb.textContent=`Неверно. Правильно: ${dictQ.ru}`; fb.style.color='var(--bad)'; } setTimeout(setupDict, 900); };
function normalize(s){ return s.toLowerCase().replace(/\s+/g,' ').trim(); }
let repCard=null; function setupRepeat(){ repCard=cards[Math.floor(Math.random()*cards.length)]||null; document.getElementById('repPrompt').textContent=repCard? repCard.ro : 'Нет карточек'; document.getElementById('repFeedback').textContent=''; }
function renderList(){ const box=document.getElementById('list'); box.innerHTML=''; cards.forEach(c=>{ const row=document.createElement('div'); row.className='row'; row.style.marginBottom='.4rem'; const left=document.createElement('div'); left.className='grow'; left.innerHTML = `<span class="kbd">${escapeHtml(c.ro)}</span> → ${escapeHtml(c.ru)} <span class="muted">[EF ${c.ef.toFixed(2)}, ivl ${c.ivl}, due ${c.dueISO}]</span>`; const del=document.createElement('button'); del.className='sm ghost'; del.textContent='Удалить'; del.onclick=()=>{ cards = cards.filter(x=>x.id!==c.id); save(); renderList(); }; row.append(left,del); box.appendChild(row); }); }
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
const fileImport=document.getElementById('fileImport'); fileImport.addEventListener('change', async (e)=>{ const f=e.target.files[0]; if(!f) return; const txt=await f.text(); if(f.name.endsWith('.json')){ try{ const arr=JSON.parse(txt); importFromJSON(arr); toast('Импорт JSON: '+arr.length); }catch(err){ toast('Ошибка JSON'); } return; } const arr=parseCSVFlexible(txt); importPairs(arr); });
function parseCSVFlexible(text){ let sep=','; if(text.split('\t').length > text.split(',').length && text.split('\t').length > text.split(';').length) sep='\t'; else if(text.split(';').length > text.split(',').length) sep=';'; return text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean).map(l=>l.split(sep)).filter(r=>r.length>=2).map(r=>[r[0], r[1]]); }
function importPairs(pairs){ let added=0; pairs.forEach(([ro,ru])=>{ ro=(ro||'').trim(); ru=(ru||'').trim(); if(!ro||!ru) return; const id='c_'+hash(ro+'|'+ru); if(cards.some(c=>c.id===id)) return; cards.push({id, ro, ru, ef:2.5, ivl:0, reps:0, lapses:0, dueISO:isoToday()}); added++; }); save(); renderList(); toast('Импортировано: '+added); }
function importFromJSON(arr){ if(!Array.isArray(arr)) return; let added=0; arr.forEach(obj=>{ if(!obj.ro||!obj.ru) return; const id='c_'+hash(obj.ro+'|'+obj.ru); if(cards.some(c=>c.id===id)) return; cards.push({id, ro:obj.ro, ru:obj.ru, ef:obj.ef||2.5, ivl:obj.ivl||0, reps:obj.reps||0, lapses:obj.lapses||0, dueISO:obj.dueISO||isoToday()}); added++; }); save(); renderList(); toast('Импорт JSON: '+added); }
function exportJSON(){ const blob=new Blob([JSON.stringify(cards,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ro_ru_cards.json'; a.click(); URL.revokeObjectURL(url); }
const synth=window.speechSynthesis;
function speak(text, lang='ro-RO'){ if(!synth) return; const u=new SpeechSynthesisUtterance(text); u.lang=lang; u.volume=parseFloat(vol.value||'1'); u.rate=parseFloat(rate.value||'1'); const v=voices.find(v=>v.name===voiceSel.value) || voices.find(v=>v.lang.startsWith('ro')) || voices[0]; if(v) u.voice=v; synth.cancel(); synth.speak(u); }
let voices=[]; function loadVoices(){ voices=synth.getVoices(); fillVoiceSel(); } function fillVoiceSel(){ const sel=document.getElementById('voiceSel'); const prev=sel.value; sel.innerHTML=''; voices.forEach(v=>{ const o=document.createElement('option'); o.value=v.name; o.textContent=`${v.name} [${v.lang}]`; sel.appendChild(o); }); if(prev) sel.value=prev; }
if(synth){ loadVoices(); if(typeof speechSynthesis !== 'undefined'){ speechSynthesis.onvoiceschanged=loadVoices; } }
function canSTT(){ return 'webkitSpeechRecognition' in window; }
function comparePronunciation(target){ if(!canSTT()){ toast('STT недоступна в этом браузере'); return; } const rec=new webkitSpeechRecognition(); rec.lang='ro-RO'; rec.interimResults=false; rec.maxAlternatives=1; rec.onresult=(e)=>{ const said=e.results[0][0].transcript.trim().toLowerCase(); const ok=similarity(normalize(target), normalize(said)); document.getElementById('repFeedback').textContent=`Распознано: "${said}" · схожесть ${Math.round(ok*100)}%`; document.getElementById('repFeedback').style.color = ok>0.7? 'var(--ok)' : ok>0.45? 'var(--warn)':'var(--bad)'; };
  rec.onerror=()=>{ toast('Ошибка распознавания'); };
  rec.start(); }
function similarity(a,b){ const sa=new Set(a.split('')), sb=new Set(b.split('')); const inter=[...sa].filter(x=>sb.has(x)).length; const union=new Set([...sa,...sb]).size; let s= inter/Math.max(union,1); const lcs=LCS(a,b); s=0.6*s + 0.4*(lcs/Math.max(a.length,b.length,1)); return s; }
function LCS(a,b){ const dp=Array(a.length+1).fill(0).map(()=>Array(b.length+1).fill(0)); for(let i=1;i<=a.length;i++){ for(let j=1;j<=b.length;j++){ dp[i][j]= a[i-1]===b[j-1]? dp[i-1][j-1]+1 : Math.max(dp[i-1][j], dp[i][j-1]); } } return dp[a.length][b.length]; }
function hash(s){ let h=0,i=0,len=s.length; while(i<len){ h=(h<<5)-h + s.charCodeAt(i++)|0; } return (h>>>0).toString(36); }
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500); }
function updateStats(){ document.getElementById('stTotal').textContent=cards.length; document.getElementById('stDue').textContent=dueCards().length; document.getElementById('stMature').textContent=cards.filter(c=>c.reps>=5).length; document.getElementById('stCorrect').textContent=session.correct; }
Array.from(document.querySelectorAll('#modeTabs .tab')).forEach(el=> el.onclick=()=> showScreen(el.dataset.mode));
const btnTTS=document.getElementById('btnTTS'); btnTTS.onclick=()=>{ if(current) speak(current.ro); };
document.getElementById('choiceSpeak').onclick=()=>{ const q=document.getElementById('choiceQ').textContent; speak(q); };
document.getElementById('dictSpeak').onclick=()=>{ const q=document.getElementById('dictQ').textContent; speak(q); };
document.getElementById('repPlay').onclick=()=>{ if(repCard) speak(repCard.ro); };
document.getElementById('repListen').onclick=()=>{ if(repCard) comparePronunciation(repCard.ro); };
const btnExport=document.getElementById('btnExport'); btnExport.onclick=exportJSON;
const btnAdd=document.getElementById('btnAdd'); btnAdd.onclick=()=>{ const ro=prompt('Румынское слово/фраза (ro)'); if(!ro) return; const ru=prompt('Перевод на русский (ru)'); if(!ru) return; importPairs([[ro,ru]]); };
const btnWipe=document.getElementById('btnWipe'); btnWipe.onclick=()=>{ if(confirm('Удалить все карточки?')){ localStorage.removeItem(LS_KEY); load(); renderList(); toast('База сброшена'); } };
const voiceSel=document.getElementById('voiceSel'); const vol=document.getElementById('vol'); const rate=document.getElementById('rate');
const btnSettings=document.getElementById('btnSettings'); btnSettings.onclick=()=> showScreen('manage');
load(); setupReview(); updateStats();
</script>
</body>
</html>
